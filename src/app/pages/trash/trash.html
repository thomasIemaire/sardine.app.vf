<p-confirmDialog [draggable]="false" />

<app-page>
    <app-page-header pageHeader label="Corbeille"
        description="Les éléments supprimés sont conservés 30 jours avant suppression définitive">
    </app-page-header>

    <div class="trash">
        <div class="trash__toolbar">
            <app-table-toolbar searchFieldPlaceholder="Rechercher dans la corbeille..." [(view)]="currentView"
                [multipleViews]="true" storageKey="trash" [actions]="toolbarActions()" (search)="onSearch($event)">
            </app-table-toolbar>
        </div>

        @if (!folders.length && !files.length) {
        <app-no-results icon="fa-solid fa-trash-can" title="La corbeille est vide"
            description="Les éléments supprimés apparaîtront ici." />
        } @else {
        <div class="trash__content">
            @if (folders.length) {
            <div class="trash__section">
                <div class="trash__section__header">
                    <app-section-header title="Dossiers" icon="fa-solid fa-folder" [count]="folders.length" />
                </div>
                @if (currentView === 'card') {
                <div class="trash__section__grid">
                    <app-grid minItemWidth="320px">
                        @for (folder of folders; track folder.id) {
                        <app-trash-item [item]="folder" (restore)="onRestoreFolder($event)"
                            (deletePermanently)="onDeleteFolder($event)" />
                        }
                    </app-grid>
                </div>
                } @else {
                <p-table [value]="folders" [tableStyle]="{ 'min-width': '40rem' }">
                    <ng-template #header>
                        <tr>
                            <th>Nom</th>
                            <th>Emplacement d'origine</th>
                            <th>Jours restants</th>
                            <th></th>
                        </tr>
                    </ng-template>
                    <ng-template #body let-folder>
                        <tr>
                            <td>
                                <div class="table-folder-name">
                                    <i class="fa-solid fa-folder"></i>
                                    {{ folder.name }}
                                </div>
                            </td>
                            <td class="text-muted">{{ folder.originalPath }}</td>
                            <td>
                                <app-days-remaining [days]="getDaysRemaining(folder.deletedAt)" />
                            </td>
                            <td>
                                <div class="table-actions">
                                    <p-button icon="fa-jelly-fill fa-regular fa-arrow-rotate-left" size="small" text rounded
                                        severity="secondary" (onClick)="onRestoreFolder(folder)"></p-button>
                                    <p-button icon="fa-jelly-fill fa-solid fa-trash" size="small" text rounded severity="danger"
                                        (onClick)="onDeleteFolder(folder)"></p-button>
                                </div>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
                }
            </div>
            }

            @if (files.length) {
            <div class="trash__section">
                <div class="trash__section__header">
                    <app-section-header title="Fichiers" icon="fa-solid fa-file" [count]="files.length" />
                </div>
                @if (currentView === 'card') {
                <div class="trash__section__grid">
                    <app-grid minItemWidth="340px">
                        @for (file of files; track file.id) {
                        <app-trash-item [item]="file" (restore)="onRestoreFile($event)"
                            (deletePermanently)="onDeleteFile($event)" />
                        }
                    </app-grid>
                </div>
                } @else {
                <p-table [value]="files" [tableStyle]="{ 'min-width': '40rem' }">
                    <ng-template #header>
                        <tr>
                            <th>Nom</th>
                            <th>Type</th>
                            <th>Taille</th>
                            <th>Emplacement d'origine</th>
                            <th>Jours restants</th>
                            <th></th>
                        </tr>
                    </ng-template>
                    <ng-template #body let-file>
                        <tr>
                            <td>
                                <div class="table-file-name">
                                    <i [class]="getFileIcon(file.fileType)"></i>
                                    {{ file.name }}
                                </div>
                            </td>
                            <td class="text-uppercase">.{{ file.extension }}</td>
                            <td>{{ formatFileSize(file.size) }}</td>
                            <td class="text-muted">{{ file.originalPath }}</td>
                            <td>
                                <app-days-remaining [days]="getDaysRemaining(file.deletedAt)" />
                            </td>
                            <td>
                                <div class="table-actions">
                                    <p-button icon="fa-jelly-fill fa-regular fa-arrow-rotate-left" size="small" text rounded
                                        severity="secondary" (onClick)="onRestoreFile(file)"></p-button>
                                    <p-button icon="fa-jelly-fill fa-solid fa-trash" size="small" text rounded severity="danger"
                                        (onClick)="onDeleteFile(file)"></p-button>
                                </div>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
                }
            </div>
            }
        </div>
        }
    </div>
</app-page>
