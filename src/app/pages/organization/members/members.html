<app-add-member-dialog (submitted)="onMembersAdded($event)" />
<app-create-team-dialog (submitted)="onTeamCreated($event)" />

<div class="page-table__wrapper">
    <div class="page-table__wrapper__table-toolbar">
        @if (isUsersTab()) {
        <app-table-toolbar searchFieldPlaceholder="Rechercher un membre..." [(view)]="currentView"
            [multipleViews]="true" storageKey="members" [actions]="userToolbarActions" (search)="onSearch($event)">
            <div toolbarFilters>
                <p-select [options]="roleOptions" optionLabel="label" placeholder="Filtrer par rôle"
                    [(ngModel)]="selectedRole" size="small" appendTo="body" (onChange)="filterByRole()" />
            </div>
        </app-table-toolbar>
        } @else {
        <app-table-toolbar searchFieldPlaceholder="Rechercher une équipe..." [(view)]="currentView"
            [multipleViews]="true" storageKey="teams" [actions]="teamToolbarActions" (search)="onTeamSearch($event)">
        </app-table-toolbar>
        }
    </div>

    @if (isUsersTab()) {
    @if (!members.length) {
    <app-no-results icon="fa-jelly-fill fa-regular fa-user" title="Aucun membre"
        description="Ajoutez votre premier membre à l'organisation." />
    } @else if (currentView === 'card') {
    <div class="page-table__wrapper__grid">
        <app-grid minItemWidth="278px">
            @for (member of members; track member.id) {
            <app-member-item [member]="member" />
            }
        </app-grid>
    </div>
    } @else {
    <div class="page-table__wrapper__table">
        <p-table [value]="members" [tableStyle]="{ 'min-width': '50rem' }">
            <ng-template #header>
                <tr>
                    <th>Nom</th>
                    <th>Email</th>
                    <th>Rôle</th>
                    <th>Date d'ajout</th>
                    <th></th>
                </tr>
            </ng-template>
            <ng-template #body let-member>
                <tr>
                    <td>{{ member.name }}</td>
                    <td>{{ member.email }}</td>
                    <td>{{ getRoleLabel(member.role) }}</td>
                    <td>{{ member.addedAt | date:'dd/MM/yyyy' }}</td>
                    <td>
                        <p-button icon="fa-solid fa-ellipsis-vertical" size="small" text rounded
                            severity="secondary"></p-button>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
    }
    } @else {
    @if (!teams.length) {
    <app-no-results icon="fa-jelly-fill fa-regular fa-users" title="Aucune équipe"
        description="Créez votre première équipe dans l'organisation." />
    } @else if (currentView === 'card') {
    <div class="page-table__wrapper__grid">
        <app-grid minItemWidth="278px">
            @for (team of teams; track team.id) {
            <app-team-item [team]="team" />
            }
        </app-grid>
    </div>
    } @else {
    <div class="page-table__wrapper__table">
        <p-table [value]="teams" [tableStyle]="{ 'min-width': '50rem' }">
            <ng-template #header>
                <tr>
                    <th>Nom</th>
                    <th>Description</th>
                    <th>Membres</th>
                    <th>Date de création</th>
                    <th></th>
                </tr>
            </ng-template>
            <ng-template #body let-team>
                <tr>
                    <td>{{ team.name }}</td>
                    <td>{{ team.description }}</td>
                    <td>{{ team.membersCount }}</td>
                    <td>{{ team.createdAt | date:'dd/MM/yyyy' }}</td>
                    <td>
                        <p-button icon="fa-solid fa-ellipsis-vertical" size="small" text rounded
                            severity="secondary"></p-button>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
    }
    }
</div>