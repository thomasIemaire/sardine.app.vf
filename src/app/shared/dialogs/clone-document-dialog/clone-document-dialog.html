<p-dialog
  [(visible)]="visible"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
  [closable]="true"
  [style]="{ width: '450px' }"
  styleClass="dialog-clone-document">
  <ng-template #header>
    <div class="dialog-header">
      <div class="dialog-icon clone">
        <i class="fa-duotone fa-solid fa-copy"></i>
      </div>
      <div class="dialog-title-wrapper">
        <h3 class="dialog-title">Cloner</h3>
        <p class="dialog-subtitle">{{ documentName() }}</p>
      </div>
    </div>
  </ng-template>

  <div class="dialog-content">
    <p class="selection-label">Sélectionnez les dossiers de destination :</p>

    <div class="folder-tree-container">
      <div
        class="root-folder"
        [class.selected]="includeRoot()"
        (click)="toggleRoot()">
        <p-checkbox
          [ngModel]="includeRoot()"
          [binary]="true"
          (ngModelChange)="includeRoot.set($event)" />
        <i class="fa-duotone fa-solid fa-house"></i>
        <span>Racine (Documents)</span>
      </div>

      <p-tree
        [value]="folderTree()"
        selectionMode="checkbox"
        [selection]="selectedNodes()"
        (selectionChange)="onSelectionChange($event)"
        [filter]="true"
        filterPlaceholder="Rechercher un dossier..."
        scrollHeight="250px"
        styleClass="folder-tree" />
    </div>

    @if (selectedCount() > 0) {
      <div class="selection-summary">
        <i class="fa-duotone fa-solid fa-circle-info"></i>
        <span>{{ selectedCount() }} destination{{ selectedCount() > 1 ? 's' : '' }} sélectionnée{{ selectedCount() > 1 ? 's' : '' }}</span>
      </div>
    }
  </div>

  <ng-template #footer>
    <div class="dialog-footer">
      <p-button
        label="Annuler"
        severity="secondary"
        size="small"
        text
        (click)="close()" />
      <p-button
        [label]="'Cloner' + (selectedCount() > 1 ? ' (' + selectedCount() + ')' : '')"
        size="small"
        [disabled]="!hasSelection"
        [loading]="isCloning()"
        (click)="onSubmit()" />
    </div>
  </ng-template>
</p-dialog>
