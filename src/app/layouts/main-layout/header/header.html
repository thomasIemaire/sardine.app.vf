<header class="header-container">
    <aside>
        <p-button
            icon="fa-duotone fa-regular fa-chevron-left"
            rounded
            text
            severity="secondary"
            size="small"
            [class.collapsed]="sidebarCollapsed()"
            (click)="toggleSidebar()">
        </p-button>
        <p-divider layout="vertical"></p-divider>
        <p-breadcrumb [model]="items()"></p-breadcrumb>
    </aside>
    <aside>
        @if (currentUser()) {
            <p-button [label]="currentUser()!.firstname + ' ' + currentUser()!.lastname" icon="fa-duotone fa-solid fa-user" text severity="secondary" size="small"></p-button>
        }
        <p-divider layout="vertical"></p-divider>
        <div class="actions-group">
            <p-button
                icon="fa-duotone fa-solid fa-bell"
                rounded
                severity="secondary"
                size="small"
                [badge]="invitationsCount() > 0 ? invitationsCount().toString() : ''"
                badgeSeverity="danger"
                (click)="openNotifications()"></p-button>
            <p-button icon="fa-duotone fa-solid fa-gear fa-fw" rounded severity="secondary" size="small" (click)="openSettings()"></p-button>
            <p-button icon="fa-duotone fa-solid fa-arrow-right-from-bracket" rounded severity="secondary" size="small" (click)="logout()"></p-button>
        </div>
    </aside>
</header>

<p-drawer [(visible)]="notificationsVisible" position="right" header="Notifications" appendTo="body">
    @if (loadingInvitations()) {
        <div class="notifications-loading">
            <i class="fa-duotone fa-solid fa-spinner fa-spin"></i>
            <span>Chargement...</span>
        </div>
    } @else if (pendingInvitations().length > 0) {
        <div class="notifications-list">
            @for (invitation of pendingInvitations(); track invitation._id) {
                <div class="notification-item invitation">
                    <div class="notification-icon">
                        <i class="fa-duotone fa-solid fa-users"></i>
                    </div>
                    <div class="notification-content">
                        <p class="notification-title">Invitation à rejoindre</p>
                        <p class="notification-team">{{ invitation.teamName }}</p>
                        @if (invitation.createdAt) {
                            <p class="notification-date">{{ invitation.createdAt | date:'dd/MM/yyyy HH:mm' }}</p>
                        }
                    </div>
                    <div class="notification-actions">
                        <p-button
                            icon="fa-solid fa-check"
                            rounded
                            size="small"
                            severity="success"
                            [text]="true"
                            (click)="acceptInvitation(invitation)"
                            pTooltip="Accepter" />
                        <p-button
                            icon="fa-solid fa-xmark"
                            rounded
                            size="small"
                            severity="danger"
                            [text]="true"
                            (click)="declineInvitation(invitation)"
                            pTooltip="Refuser" />
                    </div>
                </div>
            }
        </div>
    } @else {
        <div class="notifications-empty">
            <i class="fa-duotone fa-solid fa-bell-slash"></i>
            <p>Aucune notification pour le moment.</p>
        </div>
    }
</p-drawer>

<p-drawer [(visible)]="settingsVisible" position="right" header="Paramètres" appendTo="body">
    <div class="settings-item">
        <label>Mode</label>
        <p-selectbutton
            [options]="themeModeOptions"
            [ngModel]="themeService.themeMode()"
            (ngModelChange)="onThemeModeChange($event)"
            [allowEmpty]="false"
            size="small"
            appendTo="body">
        </p-selectbutton>
    </div>
    <div class="settings-item">
        <label>Affichage</label>
        <p-selectbutton
            [options]="displayModeOptions"
            [ngModel]="themeService.displayMode()"
            (ngModelChange)="onDisplayModeChange($event)"
            [allowEmpty]="false"
            size="small"
            appendTo="body">
        </p-selectbutton>
    </div>
</p-drawer>